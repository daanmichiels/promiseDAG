<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>promiseDAG demo</title>
    <script src="promiseDAG.js"></script>
    <script src="demo.js"></script>
    <style>
        body {
            font-family: "Segoe UI", Helvetica, sans-serif;
        }
        div#wrapper {
            margin: 0 auto;
            max-width: 60em;
            padding: 0 0.6em;
        }
    </style>
</head>
<body>
    <div id="wrapper">
    <h1>
        promiseDAG demo
    </h1>
    <p>
        This webpage demonstrates the use of promiseDAG visually.
        Below you'll find a directed acyclic graph (DAG).
        Each of the nodes represents an asynchronous task that needs to be completed.
        The lines between tasks indicate interdependencies.
    </p>
    <p>
        Please look at the source of this page to see the code.
    </p>
    <div style="display: flex; flex-direction: column; align-items: center;">
        <div id="dag">
        </div>
        <p style="display: block; text-align: center; width: 36em;">
            The promise <span id="status" style="font-weight: bold;">has not been created yet</span>.
        </p>
    </div>

    <h2>What you're seeing</h2>
    <p>
        This demo page uses <code>promiseDAG()</code> to run 10 interdependent tasks
        as efficiently as possible.<br>
        Each of the nodes in the diagram above represents a task.
    </p>
    <ul>
        <li>A blue node is a task that has not been started yet.</li>
        <li>A yellow node represents a task that is pending.</li>
        <li>A green node represents a task that was completed successfully (the promise was resolved).</li>
        <li>A red node represents a task that failed (the promise was rejected).</li>
    </ul>
    <p>
        The asynchronous tasks in this demo just consist of waiting,
        and then either succeeding (resolving the promise) or failing (rejecting the promise).
        The wait is a uniformly chosen timespan between 0 and 4 seconds.
        The probability of success of each node is about 93% (to make the chances of the entire
        network succeeding about 50%).
    </p>
    <p>
        The <code>promiseDAG()</code> function returns a promise.
        The status of this promise is displayed just below the diagram.
    </p>

    <h2>Things to note</h2>
    <p>
        Note that the order of execution of the tasks is not fixed.
        Which tasks get started when is determined by how fast the dependencies get resolved.
        Sometimes a task in the third column is already finished when a task in the first is still pending.
    </p>
    <p>
        Once a task fails, the promise returned by <code>promiseDAG()</code> is rejected and
        no further tasks are started.
    </p>
    <p>
        An naive alternative to using <code>promiseDAG()</code> is to topologically sort
        the dependency graph, and then complete the tasks sequentially. Because there are 10 tasks
        in this demo, each with average duration 2 seconds, this would take 20 seconds on average
        to complete all the tasks.
        Using <code>promiseDAG()</code>, the tasks get completed much quicker.
    </p>
    </div>
</body>
</html>
